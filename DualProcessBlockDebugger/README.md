# 双进程反调试器

运行平台：Windows

主进程作为调试器，调试子进程，使得子进程无法被调试器附加，达成反调试目的。



## 具体实现

创建命名互斥锁，用于进程确认自己是父进程还是子进程。父进程创建子进程，使用

```
DEBUG_PROCESS | DEBUG_ONLY_THIS_PROCESS
```

来调试子进程，在死循环中`WaitForDebugEvent()`，我们设定是，子进程触发异常后被父进程捕获，处理完毕后让子进程继续执行。比如可以事先加密触发异常位置的代码，用一个解密，将子进程被加密的代码段解密出来。

三种允许进程共享内核对象的机制：

- 对象句柄继承
- 为对象命名
- 复制对象句柄

这里我们选用的就是第二种。子进程尝试创建已经存在的命名的mutex时，调用`GetLastError()`会返回`ERROR_ALREADY_EXISTS`。



